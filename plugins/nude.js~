(function( helper, to, from, msg, store, sh_store, cb ) {
  'use strict';
  var resp = '', urls, i, l;

  if ( ! store.nude ) {
    store.nude = require('nude');
  }

  if (msg.match( /^sfw:/ )) {
      urls = msg.match( /(^|\s)((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/gi );
      for(i = 0, l = urls.length; i < l; i++) {
	      urls[i] = urls[i].replace(/\s+/g, '');
	      store.nude.scanURL( urls[i], function(res) {
		console.log(res);
		resp = (res) ? "NSFW" : "SFW";
		cb.call( null, to, from, resp );
	      });
      }
  }
});
